* jvo-asm [[https://travis-ci.org/jorenvo/jvo-asm][file:https://travis-ci.com/jorenvo/jvo-asm.svg?branch=master]]
This is a toy x86 assembler written from scratch. It was written to
gain a better understanding of how machine code and executable files
work. It's syntax uses a lot of emoji's because why not?
** Usage
#+BEGIN_EXAMPLE
$ cargo run -- examples/print.jas
abc
#+END_EXAMPLE

** Features
*** Constants
#+BEGIN_EXAMPLE
ğŸ–ŠLINUX_SYSCALL $128
# ...
â— LINUX_SYSCALL
#+END_EXAMPLE

*** Comments
#+BEGIN_EXAMPLE
# I'm a comment
ğŸ¦˜= âœ‰exit
#+END_EXAMPLE

*** Addressing
**** Immediate addressing
#+BEGIN_EXAMPLE
âš« â¬… $8
#+END_EXAMPLE

Load 8 into âš«.

**** Register addressing
#+BEGIN_EXAMPLE
ğŸ”´ â¬… ğŸ”µ
#+END_EXAMPLE

Copies data from ğŸ”µ into ğŸ”´.

**** Direct addressing
#+BEGIN_EXAMPLE
ğŸ“—my_number 3
# ...
ğŸ”´ â¬… my_number
#+END_EXAMPLE

This loads 3 into ğŸ”´.

**** Indirect addressing
#+BEGIN_EXAMPLE
ğŸ”´ â¬… $0~ğŸ”µ
#+END_EXAMPLE

This loads the value at the address contained in ğŸ”µ into ğŸ”´.

**** Base pointer addressing
#+BEGIN_EXAMPLE
ğŸ”´ â¬… $4~ğŸ”µ
#+END_EXAMPLE

Or alternatively with a constant:

#+BEGIN_EXAMPLE
ğŸ–ŠST_ARG $8
# ...
ğŸ”´ â¬… ST_ARG~ğŸ”µ
#+END_EXAMPLE

This is similar to indirect addressing except that it adds a constant
offset to the address in ğŸ”µ.

*** Labels
#+BEGIN_EXAMPLE
ğŸ¦˜ âœ‰exit
# ...
ğŸ“ªexit:
âšª â¬… $1
â— LINUX_SYSCALL
#+END_EXAMPLE

Labels are defined by prefixing them with ğŸ“ª and ending them with a
=:=. To refer to a label prefix it with âœ‰ instead.
*** Data sections
#+BEGIN_EXAMPLE
ğŸ“—numbers 3, 67, 34, 222, 45
# ...
ğŸ”µ â¬… numbers
#+END_EXAMPLE

Data sections start with ğŸ“— and can be referred to later by just their
name.
*** ELF
jvo-asm builds a correct, =objdump= compatible ELF header.

*** Instruction reference
**** Registers
|----------+--------|
| *Symbol* | *Name* |
|----------+--------|
| âšª       | =%eax= |
| ğŸ”´       | =%ebx= |
| ğŸ”µ       | =%ecx= |
| âš«       | =%edx= |
| â—€        | =%esp= |
| â¬‡        | =%ebp= |
|----------+--------|

**** Instructions
|------------------+-----------+--------------------------|
| *Symbol*         | *Example* | *Description*            |
|------------------+-----------+--------------------------|
| â†©                | â†©         | Return from a function   |
| â•               | âšª â• âš«  | ~âšª += âš«~               |
| â–               | âšª â– âš«  | ~âšª -= âš«~               |
| âœ–                | âšª âœ– âš«   | ~âšª *= âš«~               |
| â¬…                | ğŸ”´ â¬… $1   | Move into register       |
| â—               | â— $128   | Interrupt                |
| âš–                | âš– âš«, âšª  | Compare âš« to âšª         |
| ğŸ¦˜=               | ğŸ¦˜= âœ‰exit  | Jump if equal            |
| ğŸ¦˜â‰                | ğŸ¦˜â‰  âœ‰exit  | Jump if not equal        |
| ğŸ¦˜<               | ğŸ¦˜< âœ‰exit  | Jump if less than        |
| ğŸ¦˜â‰¤               | ğŸ¦˜â‰¤ âœ‰exit  | Jump if less or equal    |
| ğŸ¦˜>               | ğŸ¦˜> âœ‰exit  | Jump if greater than     |
| ğŸ¦˜â‰¥               | ğŸ¦˜â‰¥ âœ‰exit  | Jump if greater or equal |
| ğŸ¦˜                | ğŸ¦˜ âœ‰exit   | Unconditional jump       |
| ğŸ“               | ğŸ“ fn     | Call function            |
| ğŸ“¥               | ğŸ“¥ $8     | Push onto stack          |
| ğŸ“¤               | ğŸ“¤ ğŸ”µ     | Pop from stack           |
| ğŸ–Š                |           |                          |
| ğŸ“ª (ends with :) |           |                          |
| ğŸ“—               |           |                          |
| âœ‰                |           |                          |
| $                |           |                          |
| 123              |           |                          |
| my_constant      |           |                          |
|------------------+-----------+--------------------------|
** Implementation notes
TODO: explain tokenize -> replace constants -> compile to intermediate -> compile intermediate -> create ELF
